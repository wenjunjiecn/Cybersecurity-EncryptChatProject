## 1 设计思路

在本安全通讯系统中，我采用了先签名后加密的设计思路，并且结合了电子信封将对称密钥通过非对称加密，实现密钥安全传输的一次一密加密系统。提供了保密性、消息认证和数字签名。在系统连接之初，双方生成公钥私钥后，进行公钥交换，通过SHA256算法生成数字摘要，提供完整性校验。本系统单钥加密算法采用CBC模式的AES算法，用于对消息和签名一起进行加密和解密。非对称加密算法采用RSA,用于签名和验证签名，加密密钥和解密密钥。系统采用CS模式的TCP连接，消息系统和文件传输系统采用独立线程，同时GUI也单独运行在一个线程中。消息系统和文件系统采用相同的加密算法，实现上略有不同，消息系统建立的是长连接。文件系统传送文件时建立连接，传送完成即断开连接。编程语言采用Python。

### 1.2   发送方加密过程

![img](img.assets/clip_image002.png)

### 1.3    接收方解密过程

![img](img.assets/clip_image004.png)

### 1.4  软件界面

 

![img](img.assets/clip_image006.jpg)![img](img.assets/clip_image008.jpg)

![img](img.assets/clip_image010.jpg)![img](img.assets/clip_image012.jpg)

 

 

## 2 核心算法

### 2.1 RSA算法

RSA算法使用发送方的私钥进行签名，使用对方公钥对单次密钥进行加密。接收方使用公钥解密单次密钥并通过发送方公钥验证签名。

![img](img.assets/clip_image014.jpg)

![img](img.assets/clip_image016.jpg)

![img](img.assets/clip_image018.jpg)

![img](img.assets/clip_image020.jpg)

### 2.2 CBC模式的AES算法

CBC模式（密码分组链接），该模式的特点是使得每个分组加密依赖于所有以前的分组。AES算法采用的密钥长度和分组长度都是128位，如果分组长度不满足128位要进行填充。

![img](img.assets/clip_image022.jpg)

![img](img.assets/clip_image024.jpg)

### 2.3 加密过程（以传送消息为例，文件传输类似，实现略有不同）

![img](img.assets/clip_image026.jpg)

### 2.4 解密过程

![img](img.assets/clip_image028.jpg)

### 2.5 文件传输的加解密

文件传输采用的加解密过程和消息传输一样，采用先签名后加密的思想，并且签名前先生成消息摘要。密钥通过对方公钥进行加密，一并传输。消息传输和文件传输最大的区别是，文件大小不确定，每次发送的文件大小可能不一样，格式多样。并且因为socket缓冲区大小有限，为了实现大文件传输，必须要将大文件拆分，分段传输。每一次从文件中读取固定长度，然后对该部分内容加密后发送，由于每一段密文长度可能不同（最后一段和前面段），那么在传送每一段前先发送一个该段加密后的长度，便于接收方设置接受缓存。同时，为了解决文件格式以及方便接收方对文件完整性检验，需要在建立传输连接时，将文件名、格式、大小等信息传送给接收方。对每一段加密和解密的过程同消息传输。以下是部分核心代码。

![img](img.assets/clip_image030.jpg)

![img](img.assets/clip_image032.jpg)

 